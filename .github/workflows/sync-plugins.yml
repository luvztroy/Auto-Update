name: Sync Plugins to Telegram

on:
  push:
    branches: [main, Beta]
    paths:
      - 'UiTweaks.plugin'
      - 'QuantaHut.plugin'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Upload plugins
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_GROUP_ID }}
          COMMIT_MSG: ${{ github.event.head_commit.message }}
        run: |
          if [ -f "UiTweaks.plugin" ] && [ -f "QuantaHut.plugin" ]; then
            curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMediaGroup" \
              -F "chat_id=${CHAT_ID}" \
              -F "media=[{\"type\":\"document\",\"media\":\"attach://file1\"},{\"type\":\"document\",\"media\":\"attach://file2\",\"caption\":\"${COMMIT_MSG}\"}]" \
              -F "file1=@UiTweaks.plugin" \
              -F "file2=@QuantaHut.plugin"
          elif [ -f "UiTweaks.plugin" ]; then
            curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendDocument" \
              -F "chat_id=${CHAT_ID}" \
              -F "document=@UiTweaks.plugin" \
              -F "caption=${COMMIT_MSG}"
          elif [ -f "QuantaHut.plugin" ]; then
            curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendDocument" \
              -F "chat_id=${CHAT_ID}" \
              -F "document=@QuantaHut.plugin" \
              -F "caption=${COMMIT_MSG}"
          fi
